<loader-spinner-navbar [hidden]="!loaderNavbar"></loader-spinner-navbar>
<loader-spinner-full-screen *ngIf="loaderFullScreen"></loader-spinner-full-screen>
<app-header appTitle="Cotações">
  <button type="button" (click)="onReset()">
    Limpar
  </button>
  <button type="button" (click)="nuevo()">
    Adicionar
  </button>
  <button type="button" (click)="onFilter()" [disabled]="loaderNavbar ">
    Filtrar
  </button>
</app-header>
<app-body [breadCrumbTree]="breadCrumbTree" [show]="!loaderFullScreen">
  <div #scrollToFilter>
    <advanced-filter>
      <form [formGroup]="form">
        <div class="form-row">
          <div class="form-group col-lg-3">
            <label for="tipoData">Buscar por</label>
            <select class="form-control custom-select" id="tipoData" formControlName="tipoData">
              <option value="1">Fecha de publicacion</option>
            </select>
          </div>
          <div class="form-group col-lg-2">
            <label for="dataInicial">Fecha inicial</label>
            <input class="form-control" id="dataInicial" type="text" bsDatepicker [bsConfig]="bsConfig"
              formControlName="dataInicial">
          </div>
          <div class="form-group col-lg-2">
            <label for="dataFinal">Fecha final</label>
            <input class="form-control" id="dataFinal" type="text" bsDatepicker [bsConfig]="bsConfig"
              formControlName="dataFinal">
          </div>
          <div class="form-group col-lg-3">
            <label for="codStatus">Situacion</label>
            <ng-select type='text' [items]="situacoes" [searchable]="true" [clearable]="false"
              bindLabel="situacaoProposta" bindValue="codParametroSituacaoProposta" formControlName="codSituacao">
            </ng-select>
          </div>
          <div class="form-group col-lg-2">
            <label for="nrPedido">Núm. pedido</label>
            <input type="text" id="nrPedido" placeholder="Digite..." class="form-control" formControlName="nrPedido"
              (keydown.enter)="onFilter()">
          </div>
        </div>
        <div class="form-row">
          <!-- <div class="form-group col-lg-3">
            <label for="codEmpresa">Empresa</label>
            <ng-select
              [searchable]="true"
              [clearable]="false"
              [items]="empresas"
              placeholder="Selecione..."
              formControlName="codEmpresa"
              [virtualScroll]="true"
              labelForId="codEmpresa"
              bindLabel="nomeEmpresa"
              bindValue="idEmpresa"
              (change)="onChangeEmpresa($event.idEmpresa)"
              [ngClass]="onFieldError('codEmpresa') + ' ' + onFieldRequired(form.controls.codEmpresa)">
            </ng-select>
            <invalid-form-control [show]="onFieldInvalid('codEmpresa')" message="Empresa é obrigatório."></invalid-form-control>
          </div> -->
          <!-- <div class="form-group col-lg-2">
            <label for="codDeposito">Depósito</label>
            <ng-select
              [searchable]="true"
              [clearable]="false"
              [items]="filteredDepositos"
              placeholder="Selecione..."
              formControlName="codDeposito"
              [virtualScroll]="true"
              labelForId="codDeposito"
              bindLabel="nomeDeposito"
              bindValue="idDeposito"
              (change)="onChangeDeposito($event.idDeposito)"
              [ngClass]="onFieldError('codDeposito') + ' ' + onFieldRequired(form.controls.codDeposito)">
            </ng-select>
            <invalid-form-control [show]="onFieldInvalid('codDeposito')" message="Depósito é obrigatório."></invalid-form-control>
          </div> -->
          <!-- <div class="form-group col-lg-2">
            <label for="cliente">Cliente</label>
            <input
              type="text"
              class="form-control"
              id="cliente"
              placeholder="Digite..."
              formControlName="cliente"
              (keydown.enter)="onFilter()">
          </div> -->
          <div class="form-group col-lg-3">
            <label for="codVendedor">Vendedor</label>
            <ng-select [searchable]="true" [clearable]="false" placeholder="Selecione..." [items]="vendedores"
              formControlName="codVendedor" [virtualScroll]="true" labelForId="codVendedor" bindLabel="nome"
              bindValue="id">
            </ng-select>
          </div>
          <div *ngIf="filtroCotacoes" class="form-group col-lg-1">
            <label for="statusCliente">Status Cliente</label>
            <select class="form-control custom-select" id="statusCliente" formControlName="statusCliente">
              <option>TODOS</option>
              <option value="Ativo">ACTIVO</option>
              <option value="Inativo">INACTIVO</option>
            </select>
          </div>
          <div class="form-group " [ngClass]="{'col-lg-2': !filtroCotacoes , 'col-lg-1': filtroCotacoes}">
            <label for="registros">Registros</label>
            <select class="form-control custom-select" id="registros" formControlName="registros">
              <option>100</option>
              <option>200</option>
              <option>300</option>
            </select>
          </div>
        </div>
      </form>
    </advanced-filter>
  </div>
  <subtitles [data]="leyendas" [allowActivation]="false" [show]="dados.length > 0 && !dadosEmpty">
  </subtitles>
  <div class="row" *ngIf="dados.length > 0 && !dadosEmpty">
    <div [ngClass]="{'col-12': !showDetailPanel, 'col-6 pr-0': showDetailPanel}">
      <div class="table-responsive">
        <custom-table [config]="tableConfig">
          <ng-template #thead let-thead>
            <tr>
              <!--  <th scope="col"></th> -->
              <th scope="col" class="text-center">
                <thead-sorter value="Núm." [active]="orderBy == 'codigo_oferta'" [sort]="orderType"
                  (click)="setOrderBy('codigo_oferta')">
                </thead-sorter>
              </th>
              <th scope="col" class="text-center">
                <thead-sorter value="Fecha inicial" [active]="orderBy == 'fecha_inicial'" [sort]="orderType"
                  (click)="setOrderBy('fecha_inicial')">
                </thead-sorter>
              </th>
              <th scope="col" class="text-center">
                <thead-sorter value="Fecha final" [active]="orderBy == 'fecha_final'" [sort]="orderType"
                  (click)="setOrderBy('fecha_final')">
                </thead-sorter>
              </th>
              <th scope="col">
                <thead-sorter value="Cliente" [active]="orderBy == 'cliente'" [sort]="orderType"
                  (click)="setOrderBy('cliente')">
                </thead-sorter>
              </th>
              <th scope="col">
                <thead-sorter value="Vendedor" [active]="orderBy == 'vendedor'" [sort]="orderType"
                  (click)="setOrderBy('vendedor')">
                </thead-sorter>
              </th>
              <th scope="col">
                <thead-sorter value="Monto total bruto" [active]="orderBy == 'monto_total_bruto'" [sort]="orderType"
                  (click)="setOrderBy('monto_total_bruto')">
                </thead-sorter>
              </th>
              <th scope="col">
                <thead-sorter value="Descuento" [active]="orderBy == 'descuento'" [sort]="orderType"
                  (click)="setOrderBy('descuento')">
                </thead-sorter>
              </th>
              <th scope="col">
                <thead-sorter value="Monto total" [active]="orderBy == 'monto_total'" [sort]="orderType"
                  (click)="setOrderBy('monto_total')">
                </thead-sorter>
              </th>
              <th scope="col">
                <thead-sorter value="Peso total kg." [active]="orderBy == 'peso'" [sort]="orderType"
                  (click)="setOrderBy('peso_total')">
                </thead-sorter>
              </th>
              <th scope="col">
                <thead-sorter value="Lista" [active]="orderBy == 'lista_precio'" [sort]="orderType"
                  (click)="setOrderBy('lista_precio')">
                </thead-sorter>
              </th>
              <th scope="col">
                <thead-sorter value="Modo de entrega" [active]="orderBy == 'modo_entrega'" [sort]="orderType"
                  (click)="setOrderBy('modo_entrega')">
                </thead-sorter>
              </th>
              <th scope="col">
                <thead-sorter value="Estado" [active]="orderBy == 'estado_oferta'" [sort]="orderType"
                  (click)="setOrderBy('estado_oferta')">
                </thead-sorter>
              </th>
  
            </tr>
          </ng-template>
          <ng-template #tbody let-tbody>
            <tr *ngFor="let pedido of dados; let i = index" [class.table-active]="i == activeRow">
  
  
              <!-- <td class="text-center" [ngStyle]="styleStatusBorder(pedido)">
                <span class="d-inline-flex"> -->
              <!-- <ng-template #tooltipLiberacao>
                    <p class="mb-2">ESPERANDO LIBERACION:</p><br>
                    <div *ngIf="pedido.travas.length > 0">
                      <dl>
                        <ng-container *ngFor="let trava of pedido.travas">
                          <dd><i class="fas fa-exclamation-triangle small mr-1"></i> {{ trava['desTrava'] }}</dd>
                        </ng-container>
                      </dl>
                    </div>
                  </ng-template>  -->
  
              <!--  <ng-template #tooltipLiberacaoAberto>
                    <p class="mb-2">ESPERANDO LIBERACION:</p><br>
                    <div>
                      <dl>
                        <ng-container>
                          <dd><i class="fas fa-exclamation-triangle small mr-1"></i> PEDIDO EN ABIERTO</dd>
                        </ng-container>
                      </dl>
                    </div>
                  </ng-template>  -->
  
              <!--  <i class="mr-2 text-warning fas fa-random" *ngIf="pedido.estado_oferta === 1"
                    tooltip="Pedido transferido" placement="right"></i>
  
  
                  <i class="mr-2 text-black-50 fas fa-random" *ngIf="pedido.estado_oferta === 0"
                    tooltip="Pedido não transferido" placement="right"></i>
  
                  <i class="mr-2 text-black-50 fas fa-lock" *ngIf="pedido.pedidoEmLiberacao === 1"
                    [tooltip]="tooltipLiberacao" placement="right"></i>
                  <i class="mr-2 text-warning fas fa-unlock"
                    *ngIf="pedido.pedidoEmLiberacao === 0 && pedido.codSituacao !== 1" tooltip="Pedido liberado"
                    placement="right"></i>
                  <i class="mr-2 text-black-50 fas fa-lock"
                    *ngIf="pedido.pedidoEmLiberacao === 0 && pedido.codSituacao == 1" [tooltip]="tooltipLiberacaoAberto"
                    placement="right"></i>
  
                  <i class="mr-2 text-warning fas fa-dollar-sign" *ngIf="pedido.pedidoPreFaturado === 1"
                    tooltip="Pré-faturado" placement="right"></i>
                  <i class="mr-2 text-black-50 fas fa-dollar-sign" *ngIf="pedido.pedidoPreFaturado === 0"
                    tooltip="Pré-faturado" placement="right"></i>
  
                  <i class="mr-2 text-warning fas fa-check-square" *ngIf="pedido.pedidoFaturado === 1"
                    tooltip="Pedido faturado" placement="right"></i>
                  <i class="mr-2 text-black-50 far fa-check-square" *ngIf="pedido.pedidoFaturado === 0"
                    tooltip="Pedido não faturado" placement="right"></i>
                </span>
              </td> -->
  
  
              <td class="text-center hover" (click)="viewRegister(i, pedido)"
                [ngClass]="estoqueSuspensoClassStatusBorder(pedido.estado_oferta)">
                {{ pedido.codigo_oferta }}
              </td>
              <td class="text-center hover" (click)="viewRegister(i, pedido)">{{ pedido.fecha_inicial | date: 'dd/MM/yyyy'
                }}</td>
              <td class="text-center hover" (click)="viewRegister(i, pedido)">{{ pedido.fecha_final | date: 'dd/MM/yyyy'
                }}</td>
              <td class="hover" (click)="openModal()">{{ pedido.cliente | uppercase }}</td>
              <td class="hover" (click)="openModal()">{{ pedido.vendedor | uppercase }}</td>
              <td class="hover" (click)="openModal()">{{ pedido.monto_total_bruto }}</td>
              <td class="hover" (click)="openModal()">{{ pedido.descuento }}</td>
              <td class="hover" (click)="openModal()">{{ pedido.monto_total }}</td>
              <td class="hover" (click)="openModal()">{{ pedido.peso_total }}</td>
              <td class="hover" (click)="openModal()">{{ pedido.lista_precio }}</td>
              <td class="hover" (click)="openModal()">{{ pedido.modo_entrega }}</td>
              <td class="hover" (click)="openModal()">{{ pedido.estado_oferta }}</td>
  
  
  
  
  
              <!-- 
  
  
  
              <td class="hover" (click)="viewRegister(i, pedido)" [hidden]="showDetailPanel">{{ pedido.nomeEmpresa | uppercase }}</td>
              <td class="hover" (click)="viewRegister(i, pedido)" [hidden]="showDetailPanel">{{ pedido.nomeVendedor | uppercase }}</td> -->
            </tr>
          </ng-template>
        </custom-table>
      </div>
      <div class="d-flex justify-content-center mt-3" *ngIf="totalItems > itemsPerPage ">
        <pagination [maxSize]="maxSize" [(totalItems)]="totalItems" (pageChanged)="onPageChanged($event)"
          [(itemsPerPage)]="itemsPerPage" [boundaryLinks]="true" [(ngModel)]="currentPage" previousText="&lsaquo;"
          nextText="&rsaquo;" firstText="&laquo;" lastText="&raquo;">
        </pagination>
      </div>
    </div>
    
  </div>
  <div *ngIf="dadosEmpty && !dadosLoaded" class="text-center d-flex justify-content-center align-items-center"
    style="height: 80%">
    <empty-result message="Ninguna información encontrada"></empty-result>
  </div>
  <ng-template #modalDetalhes>
    <div class="modal-header">
      <h4 class="modal-title pull-left">Seleccione la empresa de la cotización</h4>
      <div class="d-flex justify-content-center align-items-center">
        <button type="button" class="close pull-right" aria-label="Close" (click)="hideModal()">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
    </div>
    <div class="modal-body">
      <div class="col-12">
        <form [formGroup]="form" autocomplete="off">
          <div class="form-row justify-content-center">
            <div class="form-group col pl-0">
              <label for="codEmpresaAdd">Empresa</label>
              <ng-select [searchable]="true" [clearable]="false" [items]="empresas" placeholder="Selecione..."
                formControlName="codEmpresaAdd" [virtualScroll]="true" labelForId="codEmpresaAdd"
                bindLabel="nomeEmpresa" bindValue="idEmpresa"
                [ngClass]="onFieldError('codEmpresaAdd') + ' ' + onFieldRequired(form.controls.codEmpresaAdd)">
              </ng-select>
              <invalid-form-control [show]="onFieldInvalid('codEmpresaAdd')"
                message="Empresa é obrigatório."></invalid-form-control>
            </div>
          </div>
        </form>
        <div class="form-row justify-content-center text-center" id="actions">
          <button type="button" (click)="onAdd()"
            [disabled]="form.controls.codEmpresaAdd.valid === false || loaderNavbar === true">
            Avançar
          </button>
        </div>
      </div>
    </div>
  </ng-template>
</app-body>