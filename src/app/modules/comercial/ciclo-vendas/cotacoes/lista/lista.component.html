<loader-spinner-navbar [hidden]="!loaderNavbar"></loader-spinner-navbar>
<loader-spinner-full-screen *ngIf="loaderFullScreen"></loader-spinner-full-screen>
<app-header appTitle="Cotações">
  <button type="button" (click)="onReset()">
    Limpar
  </button>
  <button type="button" (click)="nuevo()">
    Adicionar
  </button>
  <button type="button" (click)="onFilter()" [disabled]="loaderNavbar ">
    Filtrar
  </button>
</app-header>
<app-body [breadCrumbTree]="breadCrumbTree" [show]="!loaderFullScreen">
  <div #scrollToFilter>
    <advanced-filter>
      <form [formGroup]="form">
        <div class="form-row">
          <div class="form-group col-lg-3">
            <label for="tipoData">Buscar por</label>
            <select class="form-control custom-select" id="tipoData" formControlName="tipoData">
              <option value="1">Fecha de publicacion</option>
            </select>
          </div>
          <div class="form-group col-lg-2">
            <label for="dataInicial">Fecha inicial</label>
            <input class="form-control" id="dataInicial" type="text" bsDatepicker [bsConfig]="bsConfig"
              formControlName="dataInicial">
          </div>
          <div class="form-group col-lg-2">
            <label for="dataFinal">Fecha final</label>
            <input class="form-control" id="dataFinal" type="text" bsDatepicker [bsConfig]="bsConfig"
              formControlName="dataFinal">
          </div>
          <div class="form-group col-lg-3">
            <label for="codStatus">Situacion</label>
            <ng-select [items]="situacoes" [searchable]="true" [clearable]="false" labelForId="id" bindLabel="nombre"
              formControlName="codSituacao" [(ngModel)]="defaultSelection">
            </ng-select>



          </div>
          <div class="form-group col-lg-2">
            <label for="nrPedido">Núm. pedido</label>
            <input type="text" id="nrPedido" placeholder="Digite..." class="form-control" formControlName="nrPedido"
              (keydown.enter)="onFilter()">
          </div>
        </div>
        <div class="form-row">
          <!-- <div class="form-group col-lg-3">
            <label for="codEmpresa">Empresa</label>
            <ng-select
              [searchable]="true"
              [clearable]="false"
              [items]="empresas"
              placeholder="Selecione..."
              formControlName="codEmpresa"
              [virtualScroll]="true"
              labelForId="codEmpresa"
              bindLabel="nomeEmpresa"
              bindValue="idEmpresa"
              (change)="onChangeEmpresa($event.idEmpresa)"
              [ngClass]="onFieldError('codEmpresa') + ' ' + onFieldRequired(form.controls.codEmpresa)">
            </ng-select>
            <invalid-form-control [show]="onFieldInvalid('codEmpresa')" message="Empresa é obrigatório."></invalid-form-control>
          </div> -->
          <!-- <div class="form-group col-lg-2">
            <label for="codDeposito">Depósito</label>
            <ng-select
              [searchable]="true"
              [clearable]="false"
              [items]="filteredDepositos"
              placeholder="Selecione..."
              formControlName="codDeposito"
              [virtualScroll]="true"
              labelForId="codDeposito"
              bindLabel="nomeDeposito"
              bindValue="idDeposito"
              (change)="onChangeDeposito($event.idDeposito)"
              [ngClass]="onFieldError('codDeposito') + ' ' + onFieldRequired(form.controls.codDeposito)">
            </ng-select>
            <invalid-form-control [show]="onFieldInvalid('codDeposito')" message="Depósito é obrigatório."></invalid-form-control>
          </div> -->
          <!-- <div class="form-group col-lg-2">
            <label for="cliente">Cliente</label>
            <input
              type="text"
              class="form-control"
              id="cliente"
              placeholder="Digite..."
              formControlName="cliente"
              (keydown.enter)="onFilter()">
          </div> -->
          <div class="form-group col-lg-3">
            <label for="codVendedor">Vendedor</label>
            <ng-select [searchable]="true" [clearable]="false" placeholder="Selecione..." [items]="vendedores"
              formControlName="codVendedor" [virtualScroll]="true" labelForId="codVendedor" bindLabel="nome"
              bindValue="id">
            </ng-select>
          </div>
          <div *ngIf="filtroCotacoes" class="form-group col-lg-1">
            <label for="statusCliente">Status Cliente</label>
            <select class="form-control custom-select" id="statusCliente" formControlName="statusCliente">
              <option>TODOS</option>
              <option value="Ativo">ACTIVO</option>
              <option value="Inativo">INACTIVO</option>
            </select>
          </div>
          <div class="form-group " [ngClass]="{'col-lg-2': !filtroCotacoes , 'col-lg-1': filtroCotacoes}">
            <label for="registros">Registros</label>
            <select class="form-control custom-select" id="registros" formControlName="registros">
              <option>100</option>
              <option>200</option>
              <option>300</option>
            </select>
          </div>
        </div>
      </form>
    </advanced-filter>
  </div>
  <subtitles [data]="leyendas" [allowActivation]="false" [show]="dados.length > 0 && !dadosEmpty">
  </subtitles>
  <div class="row" *ngIf="dados.length > 0 && !dadosEmpty">
    <div [ngClass]="{'col-12': !showDetailPanel, 'col-6 pr-0': showDetailPanel}">
      <div class="table-responsive">
        <custom-table [config]="tableConfig">
          <ng-template #thead let-thead>
            <tr>
              <!--  <th scope="col"></th> -->
              <th scope="col" class="text-center">
                <thead-sorter value="Núm." [active]="orderBy == 'codigo_oferta'" [sort]="orderType"
                  (click)="setOrderBy('codigo_oferta')">
                </thead-sorter>
              </th>
              <th scope="col" class="text-center">
                <thead-sorter value="Fecha inicial" [active]="orderBy == 'fecha_inicial'" [sort]="orderType"
                  (click)="setOrderBy('fecha_inicial')">
                </thead-sorter>
              </th>
              <th scope="col" class="text-center">
                <thead-sorter value="Fecha final" [active]="orderBy == 'fecha_final'" [sort]="orderType"
                  (click)="setOrderBy('fecha_final')">
                </thead-sorter>
              </th>
              <th scope="col">
                <thead-sorter value="Cliente" [active]="orderBy == 'cliente'" [sort]="orderType"
                  (click)="setOrderBy('cliente')">
                </thead-sorter>
              </th>
              <th scope="col">
                <thead-sorter value="Vendedor" [active]="orderBy == 'vendedor'" [sort]="orderType"
                  (click)="setOrderBy('vendedor')">
                </thead-sorter>
              </th>
              <!--  <th scope="col">
                <thead-sorter value="Monto total bruto" [active]="orderBy == 'monto_total_bruto'" [sort]="orderType"
                  (click)="setOrderBy('monto_total_bruto')">
                </thead-sorter>
              </th>
              <th scope="col">
                <thead-sorter value="Descuento" [active]="orderBy == 'descuento'" [sort]="orderType"
                  (click)="setOrderBy('descuento')">
                </thead-sorter>
              </th> -->
              <th scope="col">
                <thead-sorter value="Monto total" [active]="orderBy == 'monto_total'" [sort]="orderType"
                  (click)="setOrderBy('monto_total')">
                </thead-sorter>
              </th>
              <th scope="col">
                <thead-sorter value="Peso total kg." [active]="orderBy == 'peso'" [sort]="orderType"
                  (click)="setOrderBy('peso_total')">
                </thead-sorter>
              </th>
              <th scope="col">
                <thead-sorter value="Lista" [active]="orderBy == 'lista_precio'" [sort]="orderType"
                  (click)="setOrderBy('lista_precio')">
                </thead-sorter>
              </th>
              <th scope="col">
                <thead-sorter value="Modo de entrega" [active]="orderBy == 'modo_entrega'" [sort]="orderType"
                  (click)="setOrderBy('modo_entrega')">
                </thead-sorter>
              </th>
              <th scope="col">
                <thead-sorter value="Estado" [active]="orderBy == 'estado_oferta'" [sort]="orderType"
                  (click)="setOrderBy('estado_oferta')">
                </thead-sorter>
              </th>

            </tr>
          </ng-template>
          <ng-template #tbody let-tbody>
            <tr *ngFor="let pedido of dados; let i = index" [class.table-active]="i == activeRow">


              <!-- <td class="text-center" [ngStyle]="styleStatusBorder(pedido)">
                <span class="d-inline-flex"> -->
              <!-- <ng-template #tooltipLiberacao>
                    <p class="mb-2">ESPERANDO LIBERACION:</p><br>
                    <div *ngIf="pedido.travas.length > 0">
                      <dl>
                        <ng-container *ngFor="let trava of pedido.travas">
                          <dd><i class="fas fa-exclamation-triangle small mr-1"></i> {{ trava['desTrava'] }}</dd>
                        </ng-container>
                      </dl>
                    </div>
                  </ng-template>  -->

              <!--  <ng-template #tooltipLiberacaoAberto>
                    <p class="mb-2">ESPERANDO LIBERACION:</p><br>
                    <div>
                      <dl>
                        <ng-container>
                          <dd><i class="fas fa-exclamation-triangle small mr-1"></i> PEDIDO EN ABIERTO</dd>
                        </ng-container>
                      </dl>
                    </div>
                  </ng-template>  -->

              <!--  <i class="mr-2 text-warning fas fa-random" *ngIf="pedido.estado_oferta === 1"
                    tooltip="Pedido transferido" placement="right"></i>
  
  
                  <i class="mr-2 text-black-50 fas fa-random" *ngIf="pedido.estado_oferta === 0"
                    tooltip="Pedido não transferido" placement="right"></i>
  
                  <i class="mr-2 text-black-50 fas fa-lock" *ngIf="pedido.pedidoEmLiberacao === 1"
                    [tooltip]="tooltipLiberacao" placement="right"></i>
                  <i class="mr-2 text-warning fas fa-unlock"
                    *ngIf="pedido.pedidoEmLiberacao === 0 && pedido.codSituacao !== 1" tooltip="Pedido liberado"
                    placement="right"></i>
                  <i class="mr-2 text-black-50 fas fa-lock"
                    *ngIf="pedido.pedidoEmLiberacao === 0 && pedido.codSituacao == 1" [tooltip]="tooltipLiberacaoAberto"
                    placement="right"></i>
  
                  <i class="mr-2 text-warning fas fa-dollar-sign" *ngIf="pedido.pedidoPreFaturado === 1"
                    tooltip="Pré-faturado" placement="right"></i>
                  <i class="mr-2 text-black-50 fas fa-dollar-sign" *ngIf="pedido.pedidoPreFaturado === 0"
                    tooltip="Pré-faturado" placement="right"></i>
  
                  <i class="mr-2 text-warning fas fa-check-square" *ngIf="pedido.pedidoFaturado === 1"
                    tooltip="Pedido faturado" placement="right"></i>
                  <i class="mr-2 text-black-50 far fa-check-square" *ngIf="pedido.pedidoFaturado === 0"
                    tooltip="Pedido não faturado" placement="right"></i>
                </span>
              </td> -->


              <td class="text-center hover" (click)="openModal(modalDetalhes, pedido.id_oferta)"
                [ngClass]="estoqueSuspensoClassStatusBorder(pedido.estado_oferta)">
                {{ pedido.codigo_oferta }}
              </td>
              <td class="text-center hover" (click)="openModal(modalDetalhes, pedido.id_oferta)">{{ pedido.fecha_inicial
                | date:
                'dd/MM/yyyy'
                }}</td>
              <td class="text-center hover" (click)="openModal(modalDetalhes, pedido.id_oferta)">{{ pedido.fecha_final |
                date: 'dd/MM/yyyy'
                }}</td>
              <td class="hover" (click)="openModal(modalDetalhes, pedido.id_oferta)">{{ pedido.cliente | uppercase }}
              </td>
              <td class="hover" (click)="openModal(modalDetalhes, pedido.id_oferta)">{{ pedido.vendedor | uppercase }}
              </td>
              <!-- <td class="hover" (click)="openModal(modalDetalhes, pedido.id_oferta)">{{ pedido.monto_total_bruto }}</td>
              <td class="hover" (click)="openModal(modalDetalhes, pedido.id_oferta)">{{ pedido.descuento }}</td> -->
              <td class="hover" (click)="openModal(modalDetalhes, pedido.id_oferta)">{{ pedido.monto_total }}</td>
              <td class="hover" (click)="openModal(modalDetalhes, pedido.id_oferta)">{{ pedido.peso_total }}</td>
              <td class="hover" (click)="openModal(modalDetalhes, pedido.id_oferta)">{{ pedido.lista_precio }}</td>
              <td class="hover" (click)="openModal(modalDetalhes, pedido.id_oferta)">{{ pedido.modo_entrega }}</td>
              <td class="hover" (click)="openModal(modalDetalhes, pedido.id_oferta)">{{ pedido.estado_oferta }}</td>
              <!-- 
              <td class="hover" (click)="viewRegister(i, pedido)" [hidden]="showDetailPanel">{{ pedido.nomeEmpresa | uppercase }}</td>
              <td class="hover" (click)="viewRegister(i, pedido)" [hidden]="showDetailPanel">{{ pedido.nomeVendedor | uppercase }}</td> -->
            </tr>
          </ng-template>
        </custom-table>
        <div class="d-flex justify-content-center mt-3" >
          <pagination [maxSize]="maxSize" [(totalItems)]="totalItems" (pageChanged)="onPageChanged($event)"
            [(itemsPerPage)]="itemsPerPage" [boundaryLinks]="true" [(ngModel)]="currentPage" previousText="&lsaquo;"
            nextText="&rsaquo;" firstText="&laquo;" lastText="&raquo;">
          </pagination>
        </div>
      </div>
    </div>

  </div>
  <div *ngIf="dadosEmpty && !dadosLoaded" class="text-center d-flex justify-content-center align-items-center"
    style="height: 80%">
    <empty-result message="Ninguna información encontrada"></empty-result>
  </div>
  <ng-template #modalDetalhes>
    <div class="modal-header">
      <h4 class="modal-title pull-left">Detalle de la oferta</h4>
      <div class="d-flex justify-content-center align-items-center">
        <button type="button" class="close pull-right" aria-label="Close" (click)="hideModal()">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
    </div>
    <div class="modal-body">
      <div class="col-md-12">
        <div class="table-responsive">
          <custom-table [config]="tableConfig" *ngIf="dados.length > 0 && !dadosEmpty">
            <ng-template #thead let-thead>
              <tr>
                <th class="text-truncate text-center" (click)="setOrderByModal('codigo_material')">
                  <thead-sorter value="Articulo" [active]="orderBy == 'Articulo'" [sort]="orderType"> Código
                  </thead-sorter>
                </th>
                <th class="text-truncate text-left" (click)="setOrderByModal('nombre_material')">
                  <thead-sorter value="Descripcion" [active]="orderBy == 'nombre_material'"
                    [sort]="orderType"></thead-sorter>
                </th>
                <th class="text-truncate text-center" (click)="setOrderByModal('cantidad')">
                  <thead-sorter value="cantidad" [active]="orderBy == 'cantidad'" [sort]="orderType"></thead-sorter>
                </th>
                <th class="text-truncate text-center" (click)="setOrderByModal('unidad')">
                  <thead-sorter value="unidad " [active]="orderBy == 'unidad'" [sort]="orderType"></thead-sorter>
                </th>
                <th class="text-truncate text-center" (click)="setOrderByModal('precio')">
                  <thead-sorter value="precio" [active]="orderBy == 'precio'" [sort]="orderType"></thead-sorter>
                </th>
                <th class="text-truncate text-center" (click)="setOrderByModal('total_bruto')">
                  <thead-sorter value="total_bruto" [active]="orderBy == 'total_bruto'"
                    [sort]="orderType"></thead-sorter>
                </th>
                <th class="text-truncate text-center" (click)="setOrderByModal('nombre_almacen')">
                  <thead-sorter value="% Descuento" [active]="orderBy == 'descuento'" [sort]="orderType"></thead-sorter>
                </th>
                <th class="text-truncate text-center" (click)="setOrderByModal('precio_descuento')">
                  <thead-sorter value="Precio descuento" [active]="orderBy == 'precio_descuento'"
                    [sort]="orderType"></thead-sorter>
                </th>
                <th class="text-truncate text-center" (click)="setOrderByModal('nombre_almacen')">
                  <thead-sorter value="Almacen" [active]="orderBy == 'nombre_almacen'"
                    [sort]="orderType"></thead-sorter>
                </th>
                <th class="text-truncate text-center" (click)="setOrderByModal('nombre_moneda')">
                  <thead-sorter value="Total con descuento" [active]="orderBy == 'nombre_moneda'"
                    [sort]="orderType"></thead-sorter>
                </th>
              </tr>
            </ng-template>
            <ng-template #tbody let-tbody>
              <ng-container>
                <tr *ngFor="let item of items">
                  <td class="font-weight-bold hover text-center">
                    {{item.codigo_material}}</td>
                  <td class="font-weight-bold hover text-left">
                    {{item.nombre_material}}</td>
                  <td class="font-weight-bold hover text-center">
                    {{item.cantidad}}</td>
                  <td class="font-weight-bold hover text-center">
                    {{item.unidad}}</td>
                  <td class="font-weight-bold hover text-center">
                    {{item.precio}}</td>
                  <td class="font-weight-bold hover text-center">
                    {{item.total_bruto}}</td>
                  <td class="font-weight-bold hover text-center">
                    0.00</td>
                  <td class="font-weight-bold hover text-center">
                    {{item.precio_descuento}}</td>
                  <td class="font-weight-bold hover text-center">
                    {{item.nombre_almacen}}</td>
                  <td class="font-weight-bold hover text-center">
                    {{item.total_bruto}} {{item.nombre_moneda}}</td>
                </tr>
                <tr class="bg-dark text-center text-dark">
                  <td colspan="8" class="border-dark"></td>
                  <td><strong>Total</strong></td>
                  <td class="text-center"><strong>{{ totalMateriales.cantidad | number:'1.4-4' }} DOLARES </strong></td>
                </tr>
              </ng-container>
            </ng-template>
          </custom-table>
          <empty-result message="Ningún registro encontrado." *ngIf="dadosEmpty"></empty-result>
          <div class="d-flex justify-content-center mt-3" >
            <pagination [maxSize]="maxSize" [(totalItems)]="totalModal" (pageChanged)="onPageChangedModal($event)"
              [(itemsPerPage)]="itemsPerPageModal" [boundaryLinks]="true" [(ngModel)]="currentPage" previousText="&lsaquo;"
              nextText="&rsaquo;" firstText="&laquo;" lastText="&raquo;">
            </pagination>
          </div>
        </div>
        <!-- <div class="form-row justify-content-center text-center" id="actions">
          <button type="button" (click)="onAdd()"
            [disabled]="form.controls.codEmpresaAdd.valid === false || loaderNavbar === true">
            Avançar
          </button>
        </div> -->
      </div>
    </div>
  </ng-template>
</app-body>