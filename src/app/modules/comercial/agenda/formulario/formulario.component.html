<loader-spinner-navbar *ngIf="loaderNavbar"></loader-spinner-navbar>
<loader-spinner-full-screen *ngIf="loaderFullScreen"></loader-spinner-full-screen>
<app-header [appTitle]="appTitle()">
  <button
    type="button"
    (click)="onCancel()"
    [disabled]="submittingForm">
    Cancelar
  </button>
  <button
    type="button"
    (click)="onSubmit()"
    [disabled]="submittingForm || !form.valid">
    Salvar
  </button>
</app-header>
<app-body [breadCrumbTree]="breadCrumbTree" [show]="!loaderFullScreen">
  <div class="row justify-content-center">
    <div class="col-lg-5">
      <form [formGroup]="form" autocomplete="off">
        <div class="form-row justify-content-center">
          <div class="form-group col">
            <label for="codTitulo">Título</label>
            <div class="input-group">
              <div class="input-group-prepend">
                <span class="input-group-text">
                  <div class="btn-group" dropdown>
                    <button dropdownToggle type="button" class="color-dropdown dropdown-toggle" aria-controls="color-dropdown">
                      <div [ngStyle]="{'backgroundColor': form.value.cor}"></div>
                    </button>
                    <ul id="color-dropdown" *dropdownMenu class="dropdown-menu">
                      <li role="menuitem">
                        <a
                          class="dropdown-item"
                          href="javascript:void(0)"
                          *ngFor="let color of colors"
                          (click)="onColorChange(color)">
                          <div class="color-hex" [ngStyle]="{'backgroundColor': color.hex}"></div>
                          <div>{{ color.descricao }}</div>
                        </a>
                      </li>
                    </ul>
                  </div>
                </span>
              </div>
              <ng-select
              [searchable]="true"
              [clearable]="true"
              class="col p-0"
              [items]="listarTitulosAgenda"
              [virtualScroll]="true"
              placeholder="Selecione..."
              labelForId="codTitulo"
              bindLabel="descricaoTitulo"
              bindValue="codTitulo"
              id="codTitulo"
              formControlName="codTitulo">
            </ng-select>
            <invalid-form-control [show]="onFieldInvalid('codTitulo')" message="Título é obrigatório."></invalid-form-control>
            </div>
          </div>
        </div>
        <div *ngIf="showInputClientes">
          <div class="form-row" *ngIf="permissoesAcesso.simuladorVendas === true">
            <div class="form-group col my-3">
              <div class="custom-control custom-checkbox">
                <input
                 type="checkbox"
                 class="custom-control-input"
                 id="gerar-cotacao-pedido"
                 formControlName="gerarCotacaoPedido"
                 (change)="onGerarCotacaoPedido()">
                <label
                  class="custom-control-label"
                  for="gerar-cotacao-pedido">
                  Gerar cotação/pedido para este contato
                </label>
              </div>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group col">
              <label for="cliente">Cliente</label>
              <ng-select
                [searchable]="true"
                [clearable]="false"
                [items]="clientes"
                [virtualScroll]="true"
                labelForId="cliente"
                bindLabel="codRazaoSocial"
                bindValue="codCliente"
                formControlName="cliente"
                [ngClass]="onFieldError('cliente') + ' ' + onFieldRequired('cliente')"
                (change)="onInput()">
              </ng-select>
            </div>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group col-md-6">
            <label for="codFormaContato">FORMA DE CONTACTO</label>
            <ng-select
              [searchable]="true"
              [clearable]="false"
              [items]="formasContato"
              formControlName="codFormaContato"
              [virtualScroll]="false"
              bindLabel="nomeFormaContato"
              bindValue="codFormaContato"
              [ngClass]="onFieldError('codFormaContato') + ' ' + onFieldRequired('codFormaContato')">
            </ng-select>
            <invalid-form-control [show]="onFieldInvalid('codFormaContato')" message="Forma de contato é obrigatório."></invalid-form-control>
          </div>
          <div class="form-group col-md-6">
            <label for="codOrigemContato">ORIGEN DE CONTACTO</label>
            <ng-select
              [searchable]="true"
              [clearable]="false"
              [items]="origensContato"
              formControlName="codOrigemContato"
              [virtualScroll]="false"
              bindLabel="nomeOrigemContato"
              bindValue="codOrigemContato"
              [ngClass]="onFieldError('codOrigemContato') + ' ' + onFieldRequired('codOrigemContato')">
            </ng-select>
            <invalid-form-control [show]="onFieldInvalid('codOrigemContato')" message="Origem do contato é obrigatório."></invalid-form-control>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group col">
            <div class="row">
              <div class="col">
                <label for="inicioData">Início</label>
              </div>
            </div>
            <div class="row">
              <div class="col-md-6 pr-0">
                <div class="input-group">
                  <div class="input-group-prepend">
                    <span class="input-group-text"><i class="far fa-calendar-alt"></i></span>
                  </div>
                  <input
                    class="form-control"
                    id="inicioData"
                    type="text"
                    bsDatepicker
                    [bsConfig]="bsConfig"
                    formControlName="inicioData"
                    (input)="onInput()"
                    [ngClass]="onFieldError('inicioData') + ' ' + onFieldRequired('inicioData')">
                </div>
                <invalid-form-control [show]="onFieldInvalid('inicioData')" message="Início é obrigatório."></invalid-form-control>
              </div>
              <div class="col-md-6">
                <div class="custom-mt d-flex">
                  <timepicker
                    [showMeridian]="false"
                    [showSpinners]="false"
                    [mousewheel]="true"
                    formControlName="inicioHorario"
                    (input)="onInput()">
                  </timepicker>
                  <div class="custom-control custom-checkbox ml-3 mt-2">
                    <input
                      type="checkbox"
                      class="custom-control-input"
                      id="diaInteiro"
                      formControlName="diaInteiro"
                      (input)="onInput()"
                      (change)="triggerAllDay()">
                    <label class="custom-control-label" for="diaInteiro">Dia inteiro</label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group col">
            <div class="row">
              <div class="col">
                <label [ngClass]="{'required': !isDisabledTime}" for="terminoData">Término</label>
              </div>
            </div>
            <div class="row">
              <div class="col-md-6 pr-0">
                <div class="input-group">
                  <div class="input-group-prepend">
                    <span class="input-group-text"><i class="far fa-calendar-alt"></i></span>
                  </div>
                  <input
                    class="form-control"
                    id="terminoData"
                    type="text"
                    bsDatepicker
                    [bsConfig]="bsConfig"
                    formControlName="terminoData"
                    (input)="onInput()">
                </div>
              </div>
              <div class="col-md-6">
                <div class="custom-mt">
                  <timepicker
                    [showMeridian]="false"
                    [showSpinners]="false"
                    [mousewheel]="true"
                    formControlName="terminoHorario"
                    (input)="onInput()">
                  </timepicker>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="form-row" *ngIf="action == 'reagendar'">
          <div class="form-group col">
            <label for="motivoReagendamento">Motivo de la reprogramación</label>
            <select
              class="form-control custom-select"
              id="motivoReagendamento"
              formControlName="motivoReagendamento"
              (change)="onInput()"
              [ngClass]="onFieldError('inicioData') + ' ' + onFieldRequired('inicioData')">
              <option *ngFor="let item of motivosReagendamento" [value]="item.id">{{ item.descricao }}</option>
            </select>
            <invalid-form-control [show]="onFieldInvalid('motivoReagendamento')" message="Motivo do reagendamento é obrigatório."></invalid-form-control>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group col">
            <label for="observacao">Observación</label>
            <textarea
              class="form-control"
              id="observacao"
              formControlName="observacao"
              (input)="onInput()">
            </textarea>
          </div>
        </div>
      </form>
    </div>
  </div>
</app-body>
